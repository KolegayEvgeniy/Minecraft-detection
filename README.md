# Детекция объектов Minecraft (YOLO + FCOS)

## О проекте

Проект посвящен решению задачи детекции 17 классов мобов Minecraft на кастомном датасете. Используются две различные архитектуры детекции объектов:

- **YOLOv8s** (Ultralytics) — современная архитектура одноэтапной детекции с высокой точностью
- **FCOS** (Custom Implementation) — anchor-free архитектура детекции с упрощенным ResNet backbone

Проект включает полный pipeline от анализа данных до обучения моделей, оценки качества и производительности.

---

## Структура проекта

```
├── artifacts/              # Результаты обучения и отчеты
│   ├── yolo_training/      # Результаты обучения YOLOv8s
│   ├── fcos_scratch/       # Результаты обучения FCOS
│   └── report.pdf          # PDF отчет с результатами
├── mmdetection/            # Датасет и структура MMDetection
│   └── datasets/
│       └── minecraft/      # Датасет Minecraft (train/valid/test)
├── data/                   # Код для работы с данными
│   └── dataset.py          # Класс датасета VOC
├── models/                 # Архитектуры моделей
│   └── fcos.py             # Реализация FCOS детектора
├── config.py               # Конфигурация обучения
├── convert_xml_to_yolo.py  # Конвертация разметки XML в YOLO формат
├── EDA_dataset.py          # Анализ и визуализация датасета
├── train_yolo.py           # Скрипт обучения YOLOv8s
├── train_fcos.py           # Скрипт обучения FCOS (MMDetection)
├── train.py                # Скрипт обучения FCOS (Custom)
├── fps.py                  # Измерение FPS и визуализация детекций
├── generate_report.py      # Генерация PDF отчета
├── losses.py               # Функции потерь
├── metrics.py              # Метрики оценки
└── minecraft_notebook.ipynb # Jupyter notebook с полным анализом
```

---

## Датасет

### Классы объектов (17 классов)

bee, chicken, cow, creeper, enderman, fox, frog, ghast, goat, llama, pig, sheep, skeleton, spider, turtle, wolf, zombie

### Формат разметки

- **Входной формат**: Pascal VOC (XML)
- **Формат для обучения**: YOLO (текстовые файлы с нормализованными координатами)

---

## Быстрый старт

### 1. Установка зависимостей

```bash
pip install -r requirements.txt
```

### 2. Подготовка данных

Конвертация разметки из XML в YOLO формат:

```bash
python convert_xml_to_yolo.py
```

### 3. Анализ датасета

Запуск EDA для проверки полноты разметки и анализа распределения классов:

```bash
python EDA_dataset.py
```

Или используйте Jupyter notebook:

```bash
jupyter notebook minecraft_notebook.ipynb
```

### 4. Обучение моделей

#### Обучение YOLOv8s:

```bash
python train_yolo.py
```

Модель сохраняется в `artifacts/yolo_training/yolov8s_minecraft_v1/weights/best.pt`

#### Обучение FCOS (Custom Implementation):

```bash
python train.py
```

Модель сохраняется в `artifacts/fcos_scratch/fcos_minecraft.pt`

#### Обучение FCOS (MMDetection):

```bash
python train_fcos.py
```

### 5. Оценка производительности и визуализация

Запуск измерения FPS и визуализации результатов:

```bash
python fps.py
```

Или в Jupyter notebook (Этап 6).

### 6. Генерация отчета

Создание PDF отчета с результатами обучения и сравнением моделей:

```bash
python generate_report.py
```

Отчет будет сохранен в `artifacts/report.pdf`

---

## Основные результаты

### Метрики качества

- **YOLOv8s**: 
  - mAP@0.5: ~0.995
  - Precision: 1.0
  - Recall: 1.0
  - F1-Score: 1.0

- **FCOS (Custom)**:
  - mAP@0.5: ~0.0 (модель требует доработки)
  - Низкая точность из-за упрощенной архитектуры и ограниченного обучения

### Производительность (FPS)

- **FCOS**: выше благодаря упрощенной архитектуре (~0.5M параметров)
- **YOLOv8s**: ниже, но приемлемая (~11M параметров, более сложная архитектура)

---

## Сравнение и выводы

### Выводы о метриках качества

**YOLOv8s** показал отличные результаты:
- **mAP@0.5: 0.995** — практически идеальная детекция объектов
- **Precision: 1.0** — все предсказанные объекты корректны (нет ложных срабатываний)
- **Recall: 1.0** — все объекты на изображениях найдены (нет пропусков)
- **F1-Score: 1.0** — идеальный баланс между точностью и полнотой
- Модель полностью справляется с задачей детекции всех 17 классов мобов Minecraft
- Готова к использованию в production-окружении

**FCOS (Custom)** показал низкие результаты:
- **mAP@0.5: ~0.0** — модель практически не детектирует объекты
- **Precision: 0.0** — большое количество ложных срабатываний или их отсутствие
- **Recall: 0.003** — найден крайне малый процент объектов
- **F1-Score: 0.0001** — практически нулевая эффективность детекции

**Возможные причины низкой точности FCOS:**
1. Упрощенная архитектура (SimpleResNet) недостаточна для задачи детекции
2. Недостаточное количество эпох обучения (10 эпох может быть мало)
3. Отсутствие предобучения на большом датасете (обучение с нуля)
4. Проблемы с настройкой гиперпараметров (learning rate, batch size)
5. Одномасштабная детекция (один feature map) против многоуровневой в YOLO
6. Упрощенная реализация может содержать баги в loss функциях или NMS

### Выводы о метриках скорости (FPS)

**FCOS быстрее YOLOv8s** благодаря:
- Упрощенной архитектуре с ~0.5M параметров (против ~11M у YOLOv8s)
- Меньшему количеству вычислений (один feature map vs. несколько уровней в FPN)
- Простому backbone (SimpleResNet) без сложных модулей типа C2f, SPPF

**YOLOv8s** имеет более сбалансированную производительность:
- Хотя модель медленнее FCOS, она все равно обеспечивает приемлемую скорость инференса
- Высокое качество детекции компенсирует небольшое снижение скорости
- Готова для реального времени при достаточных вычислительных ресурсах

### Итоговые рекомендации

1. **Для production-использования**: рекомендуется **YOLOv8s**
   - Высокое качество детекции (mAP@0.5 = 0.995)
   - Идеальные метрики Precision и Recall
   - Приемлемая скорость инференса
   - Проверенная и оптимизированная архитектура

2. **Для дальнейшей разработки FCOS** требуется:
   - Использование более мощного backbone (ResNet-50, ResNet-101)
   - Увеличение количества эпох обучения (50-100+)
   - Использование предобученных весов (transfer learning)
   - Добавление Feature Pyramid Network для многоуровневой детекции
   - Тщательная настройка гиперпараметров и loss функций
   - Увеличение размера batch size и оптимизация обучения

3. **Компромисс качество/скорость**:
   - **YOLOv8s**: высокое качество при приемлемой скорости — оптимальный выбор
   - **FCOS**: требует значительной доработки для достижения приемлемого качества

4. **Для образовательных целей**:
   - Проект демонстрирует разницу между готовым решением (YOLOv8s) и собственной реализацией (FCOS)
   - Показывает важность правильной архитектуры и предобучения для задач детекции объектов
   - Подчеркивает компромисс между простотой реализации и качеством результата

---

## Особенности реализации

### YOLOv8s

- Используется предобученная модель Ultralytics YOLOv8s
- Fine-tuning на кастомном датасете Minecraft
- Оптимизированная архитектура с FPN (Feature Pyramid Network)
- Многоуровневая детекция (P3, P4, P5)

### FCOS (Custom)

- Упрощенная реализация FCOS с нуля
- Backbone: SimpleResNet (3 блока: 32→64→128→256 каналов)
- Anchor-free детекция (прямое предсказание на пикселях)
- Одномасштабная детекция (один feature map)

---

## Требования

- Python ≥ 3.8
- PyTorch ≥ 2.1.0
- Ultralytics YOLOv8
- MMDetection (опционально)
- OpenCV
- Matplotlib
- Pandas
- NumPy
- PIL/Pillow

Полный список зависимостей см. в `requirements.txt`

---

## Использование обученных моделей

### Загрузка и использование YOLOv8s:

```python
from ultralytics import YOLO

model = YOLO('artifacts/yolo_training/yolov8s_minecraft_v1/weights/best.pt')
results = model('path/to/image.jpg', conf=0.25)
```

### Загрузка и использование FCOS:

```python
from models.fcos import FCOSDetector
import torch

device = torch.device('cuda' if torch.cuda.is_available() else 'cpu')
model = FCOSDetector(num_classes=17).to(device)
model.load_state_dict(torch.load('artifacts/fcos_scratch/fcos_minecraft.pt'))
model.eval()

# Использование через метод detect()
pred_boxes, pred_scores, pred_labels = model.detect(img_tensor, score_thr=0.25)
```

---

## Лицензия

Проект создан в образовательных целях для курса "Computer Vision" Яндекс Практикум.

---

## Автор

Проект выполнен в рамках курса "Computer Vision — CV" (Яндекс Практикум, Split 1: Object Detection).
